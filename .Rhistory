set_names(nombres_finales) %>%
slice(-c(1, 2)) %>% # Ahora slice() funcionar√° porque todas las columnas son de texto simple
filter(!is.na(gene_id) & str_detect(gene_id, "Phvul")) %>%
mutate(across(starts_with("phr"), as.numeric))
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
# Tus resultados de enriquecimiento de todos los clusters
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv"))
############  NUEVO
# --- 2. Limpieza de la Tabla S2 (Ahora s√≠ funcionar√° sin problemas) ---
cat("üßπ Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
# Paso A: Crear los nombres de las columnas
nombres_fila1 <- as.character(tab_s2_cruda[1, ])
nombres_fila2 <- as.character(tab_s2_cruda[2, ])
nombres_combinados <- paste(nombres_fila1, nombres_fila2, sep = "_")
nombres_finales <- c(
"gene_symbol_s2",
"gene_id",
nombres_combinados[3:length(nombres_combinados)]
) %>%
make_clean_names()
# Paso B: Limpiar la tabla
tab_s2_limpia <- tab_s2_cruda %>%
set_names(nombres_finales) %>%
slice(-c(1, 2)) %>% # Ahora slice() funcionar√° porque todas las columnas son de texto simple
filter(!is.na(gene_id) & str_detect(gene_id, "Phvul")) %>%
mutate(across(starts_with("phr"), as.numeric))
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
############  NUEVO
# --- 2. Limpieza de la Tabla S2 (Ahora s√≠ funcionar√° sin problemas) ---
cat("üßπ Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
# Paso A: Crear los nombres de las columnas
nombres_fila1 <- as.character(tab_s2_cruda[1, ])
nombres_fila2 <- as.character(tab_s2_cruda[2, ])
nombres_combinados <- paste(nombres_fila1, nombres_fila2, sep = "_")
nombres_finales <- c(
"gene_symbol_s2",
"gene_id",
nombres_combinados[3:length(nombres_combinados)]
) %>%
make_clean_names()
# Paso B: Limpiar la tabla
tab_s2_limpia <- tab_s2_cruda %>%
set_names(nombres_finales) %>%
slice(-c(1, 2)) %>% # Ahora slice() funcionar√° porque todas las columnas son de texto simple
filter(!is.na(gene_id) & str_detect(gene_id, "Phvul")) %>%
mutate(across(starts_with("phr"), as.numeric))
# Tus resultados de enriquecimiento de todos los clusters
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv"))
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
# scripts/10_cruce_anotaciones_FINAL.R
# Objetivo: Cargar la tabla S2 LIMPIA (en formato CSV) y cruzarla con los resultados de enriquecimiento.
# --- 2. Limpieza de la Tabla S2 (Versi√≥n Final Corregida) ---
cat("üßπ Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
# V V V PASO NUEVO Y CR√çTICO V V V
# Eliminamos la primera fila, que solo contiene el t√≠tulo del documento.
tab_s2_sin_titulo <- slice(tab_s2_cruda, -1)
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
tab_s2_cruda <- as_tibble(tab_s2_cruda)  # Forzamos que sea un tibble
str(tab_s2_cruda)        # Muestra la estructura: tipo de objeto, columnas, clases
glimpse(tab_s2_cruda)    # Similar a str(), pero m√°s legible (requiere dplyr)
head(tab_s2_cruda)       # Primeras 6 filas
tail(tab_s2_cruda)       # √öltimas 6 filas
summary(tab_s2_cruda)    # Estad√≠sticas b√°sicas por columna (solo para num√©ricas y factores)
names(tab_s2_cruda)           # Nombres de columnas
sapply(tab_s2_cruda, class)   # Clase de cada columna
table(tab_s2_cruda$columna)   # Frecuencia de valores (para factores o categ√≥ricas)
unique(tab_s2_cruda$columna)  # Valores √∫nicos
sapply(tab_s2_cruda, typeof)
sapply(tab_s2_cruda, is.numeric)
glimpse(tab_s2_cruda)
sum(is.na(tab_s2_cruda))              # Total de NAs
colSums(is.na(tab_s2_cruda))          # NAs por columna
dim(tab_s2_cruda)           # N√∫mero de filas y columnas
nrow(tab_s2_cruda)          # Solo filas
ncol(tab_s2_cruda)          # Solo columnas
skim(tab_s2_cruda)          # Resumen detallado por columna
introduce(tab_s2_cruda)     # Estad√≠sticas generales
plot_intro(tab_s2_cruda)    # Visualizaci√≥n de estructura
class(tab_s2_cruda)
source("instalar_paquetes.R")  # Ajusta la ruta si est√° en una subcarpeta
instalar_y_cargar(
paquetes_cran = c("fs", "here", "tidyverse", "data.table", "pheatmap", "writexl", "readxl", "skimr", "ggvenn", "factoextra", "stats","corrplot", "DataExplorer", "janitor", "dplyr
"),
paquetes_bioc = c("biomartr", "clusterProfiler")
)
#############################################
# --- 2. Limpieza PROFUNDA de la Tabla S2 ---
cat("üßπ Iniciando la limpieza de la Tabla S2...\n")
# V V V ESTE ES EL NUEVO PASO CLAVE V V V
# Forzamos la conversi√≥n a un data.frame est√°ndar para eliminar formatos complejos.
tab_s2_cruda <- as.data.frame(tab_s2_cruda)
# Paso A: Crear los nombres de las columnas combinando las dos primeras filas
# (El resto de esta secci√≥n no cambia)
nombres_fila1 <- as.character(tab_s2_cruda[1, ])
nombres_fila2 <- as.character(tab_s2_cruda[2, ])
nombres_fila1 <- zoo::na.locf(nombres_fila1)
nombres_combinados <- paste(nombres_fila1, nombres_fila2, sep = "_")
nombres_finales <- c(
"gene_symbol_s2",
"gene_id",
nombres_combinados[3:length(nombres_combinados)]
) %>%
janitor::make_clean_names()
cat(" -> Nombres de columnas reparados.\n")
# Paso B: Limpiar la tabla (Ahora s√≠ funcionar√°)
tab_s2_limpia <- tab_s2_cruda %>%
set_names(nombres_finales) %>%
mutate(across(everything(), as.character)) %>% # Mantenemos esta l√≠nea por seguridad
slice(-c(1, 2)) %>%
filter(!is.na(gene_id) & str_detect(gene_id, "Phvul")) %>%
mutate(across(starts_with("phr"), as.numeric))
# Tus resultados de enriquecimiento de todos los clusters
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv"))
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
#############################################
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
tab_s2_cruda <- as_tibble(tab_s2_cruda)  # Forzamos que sea un tibble
# scripts/10_cruce_anotaciones_FINAL.R
# Objetivo: Cargar la tabla S2 LIMPIA (en formato CSV) y cruzarla con los resultados de enriquecimiento.
# --- 2. Limpieza de la Tabla S2 (Versi√≥n Final Corregida) ---
cat("üßπ Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
# V V V PASO NUEVO Y CR√çTICO V V V
# Eliminamos la primera fila, que solo contiene el t√≠tulo del documento.
tab_s2_sin_titulo <- tab_s2_cruda %>%
slice(-1)  # Elimina la primera fila
cat("üßπ Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
# Lectura segura
tab_s2_cruda <- read_csv(
here("datos", "tab_s2_early_signaling.csv"),
col_names = FALSE,
trim_ws = TRUE,
na = c("", "NA", "N/A")
)
# Forzamos tibble y verificamos
tab_s2_cruda <- as_tibble(tab_s2_cruda)
print(class(tab_s2_cruda))  # Debe decir: tbl_df, tbl, data.frame
# Eliminamos la primera fila (t√≠tulo del documento)
tab_s2_sin_titulo <- tab_s2_cruda %>%
slice(-1)
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv"))
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
#############################################
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
tab_s2_cruda <- as_tibble(tab_s2_cruda)  # Forzamos que sea un tibble
cat("Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
tab_s2_limpia <- read_csv(
here("datos", "tab_s2_early_signaling.csv"),
col_names = FALSE,
skip = 2
) %>%
row_to_names(row_number = 1) %>%
clean_names() %>%
mutate(across(everything(), as.character)) %>%
mutate(
across(contains("log2fc"), as.numeric),
across(contains("padj"), as.numeric)
)
cat("Tabla S2 limpiada correctamente.\n")
cat("Filas:", nrow(tab_s2_limpia), "| Columnas:", ncol(tab_s2_limpia), "\n")
print(head(tab_s2_limpia))
# Guardar la tabla limpia en la carpeta "salidas_data" (o donde quieras)
write_csv(
tab_s2_limpia,
here("salidas_data", "tab_s2_early_signaling_LIMPIA.csv")
)
cat("Tabla S2 limpia guardada en: salidas_data/tab_s2_early_signaling_limpia.csv\n")
# Guardar la tabla limpia en la carpeta "salidas_data" (o donde quieras)
write_csv(
tab_s2_limpia,
here("salidas_data", "tab_s2_early_signaling_limpia.csv")
)
cat("Tabla S2 limpia guardada en: salidas_data/tab_s2_early_signaling_limpia.csv\n")
View(tab_s2_limpia)
class(tab_s2_limpia)
str(tab_s2_limpia)        # Muestra la estructura: tipo de objeto, columnas, clases
glimpse(tab_s2_limpia)    # Similar a str(), pero m√°s legible (requiere dplyr)
head(tab_s2_limpia)       # Primeras 6 filas
tail(tab_s2_limpia)       # √öltimas 6 filas
summary(tab_s2_limpia)    # Estad√≠sticas b√°sicas por columna (solo para num√©ricas y factores)
names(tab_s2_limpia)           # Nombres de columnas
sapply(tab_s2_limpia, class)   # Clase de cada columna
table(tab_s2_limpia$columna)   # Frecuencia de valores (para factores o categ√≥ricas)
unique(tab_s2_limpia$columna)  # Valores √∫nicos
sapply(tab_s2_limpia, typeof)
sapply(tab_s2_limpia, is.numeric)
glimpse(tab_s2_limpia)
sum(is.na(tab_s2_limpia))              # Total de NAs
colSums(is.na(tab_s2_limpia))          # NAs por columna
dim(tab_s2_limpia)           # N√∫mero de filas y columnas
nrow(tab_s2_limpia)          # Solo filas
ncol(tab_s2_limpia)          # Solo columnas
skim(tab_s2_limpia)          # Resumen detallado por columna
introduce(tab_s2_limpia)     # Estad√≠sticas generales
plot_intro(tab_s2_limpia)    # Visualizaci√≥n de estructura
# --- 3. Cruzar (Unir) los Datos ---
cat("\nüîó Cruzando tus resultados de enriquecimiento con los datos de genes simbi√≥ticos...\n")
# "Expandimos" tu tabla maestra para tener una fila por gen
tabla_genes_enriquecidos <- tabla_maestra_clusters %>%
separate_rows(geneID, sep = "/") %>%
rename(gene_id = geneID)
class(tabla_maestra_clusters)
str(tabla_maestra_clusters)        # Muestra la estructura: tipo de objeto, columnas, clases
glimpse(tabla_maestra_clusters)    # Similar a str(), pero m√°s legible (requiere dplyr)
head(tabla_maestra_clusters)       # Primeras 6 filas
tail(tabla_maestra_clusters)       # √öltimas 6 filas
summary(tabla_maestra_clusters)    # Estad√≠sticas b√°sicas por columna (solo para num√©ricas y factores)
names(tabla_maestra_clusters)           # Nombres de columnas
sapply(tabla_maestra_clusters, class)   # Clase de cada columna
table(tabla_maestra_clusters$columna)   # Frecuencia de valores (para factores o categ√≥ricas)
unique(tabla_maestra_clusters$columna)  # Valores √∫nicos
sapply(tabla_maestra_clusters, typeof)
sapply(tabla_maestra_clusters, is.numeric)
glimpse(tabla_maestra_clusters)
sum(is.na(tabla_maestra_clusters))              # Total de NAs
colSums(is.na(tabla_maestra_clusters))          # NAs por columna
dim(tabla_maestra_clusters)           # N√∫mero de filas y columnas
nrow(tabla_maestra_clusters)          # Solo filas
ncol(tabla_maestra_clusters)          # Solo columnas
skim(tabla_maestra_clusters)          # Resumen detallado por columna
introduce(tabla_maestra_clusters)     # Estad√≠sticas generales
plot_intro(tabla_maestra_clusters)    # Visualizaci√≥n de estructura
source("instalar_paquetes.R")  # Ajusta la ruta si est√° en una subcarpeta
instalar_y_cargar(
paquetes_cran = c("fs", "here", "tidyverse", "data.table", "pheatmap", "writexl", "readxl", "skimr", "ggvenn", "factoextra", "stats","corrplot", "DataExplorer", "janitor", "dplyr
", "stringr"),
paquetes_bioc = c("biomartr", "clusterProfiler")
)
#library(stringr)
# 1. Expandir geneID: cada gen en una fila
clusters_expandido <- tabla_maestra_clusters %>%
select(cluster, ID, Description, RichFactor, FoldEnrichment, p.adjust, geneID) %>%
separate_rows(geneID, sep = "/") %>%
rename(id_raw = geneID)
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv")) %>%
as_tibble()
source("instalar_paquetes.R")  # Ajusta la ruta si est√° en una subcarpeta
instalar_y_cargar(
paquetes_cran = c("fs", "here", "tidyverse", "data.table", "pheatmap", "writexl", "readxl", "skimr", "ggvenn", "factoextra", "stats","corrplot", "DataExplorer", "janitor", "dplyr
", "stringr", "tidyr", "readr", ),
paquetes_bioc = c("biomartr", "clusterProfiler")
)
source("instalar_paquetes.R")  # Ajusta la ruta si est√° en una subcarpeta
instalar_y_cargar(
paquetes_cran = c("fs", "here", "tidyverse", "data.table", "pheatmap", "writexl", "readxl", "skimr", "ggvenn", "factoextra", "stats","corrplot", "DataExplorer", "janitor", "dplyr
", "stringr", "tidyr", "readr"),
paquetes_bioc = c("biomartr", "clusterProfiler")
)
#library(readr)
#library(dplyr)
#library(tidyr)
#library(stringr)
#library(here)
#library(janitor)
cat("Iniciando cruce final...\n")
# --- CARGAR Y CONVERTIR A TIBBLE ---
tab_s2_limpia <- read_csv(here("salidas_data", "tab_s2_early_signaling_limpia.csv")) %>%
as_tibble()
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv")) %>%
as_tibble()  # ‚Üê ¬°ESTA L√çNEA ES LA CLAVE!
# --- EXPANDIR geneID ---
clusters_expandido <- tabla_maestra_clusters %>%
select(cluster, ID, Description, RichFactor, FoldEnrichment, p.adjust, geneID) %>%
separate_rows(geneID, sep = "/") %>%
rename(id_raw = geneID) %>%
mutate(
id_clean = str_remove(id_raw, "\\.\\d+$") %>% str_trim()
)
cat("Iniciando cruce final...\n")
# --- CARGAR Y CONVERTIR ---
tab_s2_limpia <- read_csv(here("salidas_data", "tab_s2_early_signaling_limpia.csv")) %>%
as_tibble()
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv")) %>%
as_tibble()
# --- EXPANDIR geneID (con dplyr:: expl√≠cito) ---
clusters_expandido <- tabla_maestra_clusters %>%
dplyr::select(cluster, ID, Description, RichFactor, FoldEnrichment, p.adjust, geneID) %>%
tidyr::separate_rows(geneID, sep = "/") %>%
dplyr::rename(id_raw = geneID) %>%
dplyr::mutate(
id_clean = stringr::str_remove(id_raw, "\\.\\d+$") %>% stringr::str_trim()
)
# --- LIMPIAR IDs en S2 ---
tab_s2_limpia <- tab_s2_limpia %>%
dplyr::mutate(
id_clean = stringr::str_remove(id, "\\.\\d+$") %>% stringr::str_trim()
)
# --- CRUCE ---
cruce_final <- tab_s2_limpia %>%
dplyr::left_join(clusters_expandido, by = "id_clean") %>%
dplyr::select(-id_raw, -id_clean)
# --- GUARDAR ---
ruta_final <- here("salidas_data", "cruce_S2_con_clusters_ENRIQUECIDO.csv")
write_csv(cruce_final, ruta_final)
cat("¬°CRUCE COMPLETADO!\n")
cat("Archivo guardado en:", ruta_final, "\n")
cat("Genes de S2 con GO asignado:", sum(!is.na(cruce_final$cluster)), "de", nrow(tab_s2_limpia), "\n")
###########################
# Ver algunos IDs limpios de cada tabla
cat("=== IDs en S2 (limpios) ===\n")
print(head(tab_s2_limpia$id_clean, 10))
cat("\n=== IDs en GO (limpios) ===\n")
print(head(clusters_expandido$id_clean, 10))
# ¬øHay intersecci√≥n?
interseccion <- intersect(tab_s2_limpia$id_clean, clusters_expandido$id_clean)
cat("\nGenes en com√∫n:", length(interseccion), "\n")
if(length(interseccion) > 0) print(interseccion)
# --- 1. Cargar los datos que vamos a usar ---
# Tus resultados de enriquecimiento de todos los clusters
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv")) %>%
as_tibble()
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
#############################################
tab_s2_cruda <- read_csv(here("datos", "tab_s2_early_signaling.csv"), col_names = FALSE)
tab_s2_cruda <- as_tibble(tab_s2_cruda)  # Forzamos que sea un tibble
cat("Iniciando la limpieza de la Tabla S2 (versi√≥n CSV)...\n")
tab_s2_limpia <- read_csv(
here("datos", "tab_s2_early_signaling.csv"),
col_names = FALSE,
skip = 2
) %>%
row_to_names(row_number = 1) %>%
clean_names() %>%
mutate(across(everything(), as.character)) %>%
mutate(
across(contains("log2fc"), as.numeric),
across(contains("padj"), as.numeric)
)
cat("Tabla S2 limpiada correctamente.\n")
cat("Filas:", nrow(tab_s2_limpia), "| Columnas:", ncol(tab_s2_limpia), "\n")
print(head(tab_s2_limpia))
# Guardar la tabla limpia en la carpeta "salidas_data" (o donde quieras)
write_csv(
tab_s2_limpia,
here("salidas_data", "tab_s2_early_signaling_limpia.csv")
)
cat("Tabla S2 limpia guardada en: salidas_data/tab_s2_early_signaling_limpia.csv\n")
###################3hasta aqui todo funciono bien
cat("Iniciando cruce final...\n")
# --- CARGAR Y CONVERTIR ---
tab_s2_limpia <- read_csv(here("salidas_data", "tab_s2_early_signaling_limpia.csv")) %>%
as_tibble()
tabla_maestra_clusters <- read_csv(here("salidas_data", "enrich_go_TODOS_LOS_CLUSTERS.csv")) %>%
as_tibble()
# --- EXPANDIR geneID (con dplyr:: expl√≠cito) ---
clusters_expandido <- tabla_maestra_clusters %>%
dplyr::select(cluster, ID, Description, RichFactor, FoldEnrichment, p.adjust, geneID) %>%
tidyr::separate_rows(geneID, sep = "/") %>%
dplyr::rename(id_raw = geneID) %>%
dplyr::mutate(
id_clean = stringr::str_remove(id_raw, "\\.\\d+$") %>% stringr::str_trim()
)
# --- LIMPIAR IDs en S2 ---
tab_s2_limpia <- tab_s2_limpia %>%
dplyr::mutate(
id_clean = stringr::str_remove(id, "\\.\\d+$") %>% stringr::str_trim()
)
# --- CRUCE ---
cruce_final <- tab_s2_limpia %>%
dplyr::left_join(clusters_expandido, by = "id_clean") %>%
dplyr::select(-id_raw, -id_clean)
# --- GUARDAR ---
ruta_final <- here("salidas_data", "cruce_S2_con_clusters_ENRIQUECIDO.csv")
write_csv(cruce_final, ruta_final)
cat("¬°CRUCE COMPLETADO!\n")
cat("Archivo guardado en:", ruta_final, "\n")
cat("Genes de S2 con GO asignado:", sum(!is.na(cruce_final$cluster)), "de", nrow(tab_s2_limpia), "\n")
# Genes simbiontes con GO
genes_con_go <- cruce_final %>%
filter(!is.na(cluster)) %>%
select(name, id, cluster, Description, p.adjust) %>%
arrange(p.adjust)
# --- SOLUCI√ìN: Usa dplyr:: ---
genes_con_go <- cruce_final %>%
dplyr::filter(!is.na(cluster)) %>%
dplyr::select(name, id, cluster, Description, p.adjust) %>%
dplyr::arrange(p.adjust)
# Ver resultado
print(genes_con_go)
# Guardar
write_csv(genes_con_go, here("salidas_data", "genes_S2_en_GO_enriquecido.csv"))
class(genes_con_go)
str(genes_con_go)        # Muestra la estructura: tipo de objeto, columnas, clases
glimpse(genes_con_go)    # Similar a str(), pero m√°s legible (requiere dplyr)
head(genes_con_go)       # Primeras 6 filas
tail(genes_con_go)       # √öltimas 6 filas
summary(genes_con_go)    # Estad√≠sticas b√°sicas por columna (solo para num√©ricas y factores)
names(genes_con_go)           # Nombres de columnas
sapply(genes_con_go, class)   # Clase de cada columna
table(genes_con_go$columna)   # Frecuencia de valores (para factores o categ√≥ricas)
unique(genes_con_go$columna)  # Valores √∫nicos
sapply(genes_con_go, typeof)
sapply(genes_con_go, is.numeric)
glimpse(genes_con_go)
sum(is.na(genes_con_go))              # Total de NAs
colSums(is.na(genes_con_go))          # NAs por columna
dim(genes_con_go)           # N√∫mero de filas y columnas
nrow(genes_con_go)          # Solo filas
ncol(genes_con_go)          # Solo columnas
skim(genes_con_go)          # Resumen detallado por columna
introduce(genes_con_go)     # Estad√≠sticas generales
plot_intro(genes_con_go)    # Visualizaci√≥n de estructura
source("instalar_paquetes.R")  # Ajusta la ruta si est√° en una subcarpeta
instalar_y_cargar(
paquetes_cran = c("fs", "here", "tidyverse", "data.table", "pheatmap", "writexl", "readxl", "skimr", "ggvenn", "factoextra", "stats","corrplot", "DataExplorer", "janitor", "dplyr
", "stringr", "tidyr", "readr", "ggplot2"),
paquetes_bioc = c("biomartr", "clusterProfiler")
)
# Contar genes por cluster
resumen <- genes_con_go %>%
count(cluster, name = "n_genes") %>%
mutate(cluster = factor(cluster, levels = c("cluster_1", "cluster_5")))
# Gr√°fico
ggplot(resumen, aes(x = cluster, y = n_genes, fill = cluster)) +
geom_col(width = 0.6, alpha = 0.9) +
geom_text(aes(label = n_genes), vjust = -0.5, size = 5, fontface = "bold") +
scale_fill_manual(values = c("cluster_1" = "#1f78b4", "cluster_5" = "#33a02c")) +
labs(
title = "Genes simbiontes en clusters enriquecidos (GO)",
subtitle = "16 de 194 genes (8.2%)",
x = "M√≥dulo de coexpresi√≥n",
y = "N√∫mero de genes simbiontes",
caption = "p.adjust < 0.05"
) +
theme_minimal(base_size = 14) +
theme(
legend.position = "none",
plot.title = element_text(face = "bold"),
axis.title = element_text(face = "bold")
)
ggsave(here("salidas_data", "FIG_genes_simbiontes_en_clusters.png"),
width = 7, height = 6, dpi = 300, bg = "white")
# Tabla bonita para paper
tabla_suplemento <- genes_con_go %>%
distinct(name, id, .keep_all = TRUE) %>%
select(name, id, cluster, Description, p.adjust) %>%
arrange(cluster, p.adjust)
source("instalar_paquetes.R")  # Ajusta la ruta si est√° en una subcarpeta
instalar_y_cargar(
paquetes_cran = c("fs", "here", "tidyverse", "data.table", "pheatmap", "writexl", "readxl", "skimr", "ggvenn", "factoextra", "stats","corrplot", "DataExplorer", "janitor", "dplyr
", "stringr", "tidyr", "readr", "ggplot2", "conflicted"),
paquetes_bioc = c("biomartr", "clusterProfiler")
)
conflict_prefer("filter", "dplyr")
conflict_prefer("select", "dplyr")
conflict_prefer("mutate", "dplyr")
conflict_prefer("arrange", "dplyr")
conflict_prefer("summarise", "dplyr")
# Tabla bonita para paper
tabla_suplemento <- genes_con_go %>%
distinct(name, id, .keep_all = TRUE) %>%
select(name, id, cluster, Description, p.adjust) %>%
arrange(cluster, p.adjust)
write_csv(tabla_suplemento, here("salidas_data", "Tabla_S2_genes_enriquecidos.csv"))
class(tabla_suplemento)
str(tabla_suplemento)        # Muestra la estructura: tipo de objeto, columnas, clases
glimpse(tabla_suplemento)    # Similar a str(), pero m√°s legible (requiere dplyr)
head(tabla_suplemento)       # Primeras 6 filas
tail(tabla_suplemento)       # √öltimas 6 filas
summary(tabla_suplemento)    # Estad√≠sticas b√°sicas por columna (solo para num√©ricas y factores)
names(tabla_suplemento)           # Nombres de columnas
sapply(tabla_suplemento, class)   # Clase de cada columna
table(tabla_suplemento$columna)   # Frecuencia de valores (para factores o categ√≥ricas)
unique(tabla_suplemento$columna)  # Valores √∫nicos
sapply(tabla_suplemento, typeof)
sapply(tabla_suplemento, is.numeric)
glimpse(tabla_suplemento)
sum(is.na(tabla_suplemento))              # Total de NAs
colSums(is.na(tabla_suplemento))          # NAs por columna
dim(tabla_suplemento)           # N√∫mero de filas y columnas
nrow(tabla_suplemento)          # Solo filas
ncol(tabla_suplemento)          # Solo columnas
skim(tabla_suplemento)          # Resumen detallado por columna
introduce(tabla_suplemento)     # Estad√≠sticas generales
plot_intro(tabla_suplemento)    # Visualizaci√≥n de estructura
# Ejemplo: Log2FC de los 16 genes en cada contraste
expr_16 <- cruce_final %>%
filter(!is.na(cluster)) %>%
select(name, id, contains("log2fc")) %>%
distinct(name, .keep_all = TRUE) %>%
pivot_longer(cols = starts_with("log2fc"), names_to = "contraste", values_to = "log2fc") %>%
mutate(contraste = case_when(
contraste == "log2fc" ~ "PHR-L7OX vs EV (-Pi)",
contraste == "log2fc_2" ~ "PHR-L7OX vs EV (+Pi)",
contraste == "log2fc_3" ~ "PHR-L7RNAi vs EV (-Pi)",
TRUE ~ contraste
))
# Heatmap
library(pheatmap)
pheatmap(
expr_16 %>% pivot_wider(names_from = contraste, values_from = log2fc) %>% column_to_rownames("name"),
scale = "row",
main = "Expresi√≥n de 16 genes simbiontes bajo PHR-L7"
)
# Ejemplo: Log2FC de los 16 genes en cada contraste
expr_16 <- cruce_final %>%
filter(!is.na(cluster)) %>%
select(name, id, contains("log2fc")) %>%
distinct(name, .keep_all = TRUE) %>%
pivot_longer(cols = starts_with("log2fc"), names_to = "contraste", values_to = "log2fc") %>%
mutate(contraste = case_when(
contraste == "log2fc" ~ "PHR-L7OX vs EV (-Pi)",
contraste == "log2fc_2" ~ "PHR-L7OX vs EV (+Pi)",
contraste == "log2fc_3" ~ "PHR-L7RNAi vs EV (-Pi)",
TRUE ~ contraste
))
# Heatmap
library(pheatmap)
pheatmap(
expr_16 %>% pivot_wider(names_from = contraste, values_from = log2fc) %>% column_to_rownames("name"),
scale = "row",
main = "Expresi√≥n de 16 genes simbiontes bajo PHR-L7"
)
